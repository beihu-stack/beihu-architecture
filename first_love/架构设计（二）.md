## 架构设计（二）

### 高可用

- 衡量标准：

  - 传统：2个9、3个9（可用百分比为99.9%，按一年算不可用时间为：(1-99.9%) * 365*24 = 8.76小时）、4个9、5个9等
  - 合理：不可用请求量占全年请求量的百分比

- 手段：

  - 服务冗余
  - 无状态话（动态扩容）
  - 负载均衡（识别异常节点，自动路由到其他节点）
  - 幂等设计
  - 超时机制
  - 异步化设计
  - 服务限流降级熔断
  - 数据复制、缓存、Sharding
  - 架构拆分、服务治理

- 监控

  - 日志上报，flume收集到kafka，由Spark实时计算统计，窗口5分钟

- 服务分级（降低或者避免服务出现故障）

  ![image-20200709234055981](assets/image-20200709234055981.png) ![image-20200709234244199](assets/image-20200709234244199.png)

  ![image-20200709234632790](assets/image-20200709234632790.png)

